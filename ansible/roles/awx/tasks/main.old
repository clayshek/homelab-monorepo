---
# main.yml tasks for awx role


# -------------- AWX install and Pre-reqs ---------------

- name: Update repositories cache and install Ansible
  apt:
    name: ansible
    update_cache: true

- name: AWX Prereqs
  apt: 
    pkg:
      - apt-transport-https 
      - ca-certificates
      - curl
      - gnupg-agent
      - software-properties-common
    state: present
    update_cache: true

- name: Add Docker apt key
  ansible.builtin.apt_key:
    url: https://download.docker.com/linux/ubuntu/gpg
    state: present

- name: Get distribution
  command: lsb_release -cs
  register: distro    

- name: Add Docker repository into sources list
  apt_repository:
    repo: "deb [arch=amd64] https://download.docker.com/linux/ubuntu {{ distro.stdout }} stable"
    state: present
    update_cache: true  

- name: Docker
  apt: 
    pkg:
      - docker-ce 
      - docker-ce-cli
      - containerd.io
      - docker-compose
    state: present      

- name: Ensure group "docker" exists 
  ansible.builtin.group:
    name: docker
    state: present    

- name: Appending the group 'docker' to the user's groups
  ansible.builtin.user:
    name: ubuntu
    groups: docker
    append: yes    

- name: Nodejs & NPM
  apt: 
    pkg:
      - nodejs 
      - npm
    state: present   

#- name: NPM globally.
  #npm:
    #name: npm
    #global: yes     

- name: Python, Git, & more dependencies
  apt: 
    pkg:
      - python3-pip
      - git
      - pwgen
      - vim
    state: present 
    update_cache: true

- name: Install requests python package version 2.14.2
  pip:
    name: requests==2.14.2

- name: Install docker-compose python package version 1.27.4
  pip:
    name: docker-compose==1.25.0