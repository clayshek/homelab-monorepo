{
    "description": "Build ESXi template",
    "variables": {
        "iso_filename": "nas-share:iso/VMware-VMvisor-Installer-7.0U3-18644231.x86_64.iso",
        "iso_checksum": "8c5fc24894394035402f66f3824beb7234b757dd2b5531379cb310cedfdf0996",
        "template_name": "tpl-esxi-7.0U3",
        "template_description": "ESXi 7.0 U3 template generated by Packer on {{ isotime \"2006-01-02T15:04:05Z\" }}. Username: root",
        "kickstart_filename": "ks.cfg",
        "vm_enable_qemu_agent": "false",
        "vm_memory": "4096",
        "vm_cores": "2",
        "vm_sockets": "2",
        "vm_cpu_type": "host",
        "vm_network_adapter_model": "vmxnet3",
        "vm_network_adapter_bridge": "vmbr0",
        "vm_disk_size": "50G",
        "vm_disk_type": "sata",
        "vm_disk_format": "qcow2",
        "vm_storage_pool": "vm-store",
        "vm_storage_pool_type": "directory",
        "ssh_username": "root",
        "ssh_password": "VMware1!",
        "ssh_host": "192.168.2.91"
    },

    "sensitive-variables": ["proxmox_password"],    

    "builders": [
    {
      "type": "proxmox",
      "proxmox_url": "{{user `proxmox_api_url`}}",
      "insecure_skip_tls_verify": true,
      "username": "{{user `proxmox_username`}}",
      "password": "{{user `proxmox_password`}}",
      "node": "{{user `proxmox_node`}}",
      "iso_file": "{{user `iso_filename`}}",
      "iso_checksum": "{{user `iso_checksum`}}",
      "qemu_agent": "{{user `vm_enable_qemu_agent`}}",
      "memory": "{{user `vm_memory`}}",
      "cores": "{{user `vm_cores`}}",
      "sockets": "{{user `vm_sockets`}}",
      "cpu_type": "{{user `vm_cpu_type`}}",
      "network_adapters": [
        {
          "bridge": "{{user `vm_network_adapter_bridge`}}",
          "model": "{{user `vm_network_adapter_model`}}"
        }
      ],
      "disks": [
        {
          "type": "{{user `vm_disk_type`}}",
          "disk_size": "{{user `vm_disk_size`}}",
          "format": "{{user `vm_disk_format`}}",
          "storage_pool": "{{user `vm_storage_pool`}}",
          "storage_pool_type": "{{user `vm_storage_pool_type`}}"
        }
      ],

      "http_directory": "esxi/http",
      "boot_wait": "2s",
      "boot_command": [
        "<enter>",
        "<SHIFT+O>",
        " allowLegacyCPU=true ks=http://{{.HTTPIP}}:{{.HTTPPort}}/{{user `kickstart_filename`}}",
        "<enter>" ,
        ""
      ],

      "ssh_host": "{{user `ssh_host`}}",
      "ssh_username": "{{user `ssh_username`}}",
      "ssh_password": "{{user `ssh_password`}}",
      "ssh_timeout": "20m",

      "unmount_iso": true,
      "template_name": "{{user `template_name`}}",
      "template_description": "{{user `template_description`}}"

    }
]
}