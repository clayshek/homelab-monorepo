{
  "description": "Build Rocky Linux 8.5 Proxmox template",
  "variables": {
      "iso_filename": "nas-share:iso/Rocky-8.5-x86_64-minimal.iso",
      "iso_checksum": "4eb2ae6b06876205f2209e4504110fe4115b37540c21ecfbbc0ebc11084cb779",
      "template_name": "tpl-rocky-8-5",
      "template_description": "Rocky Linux 8.5 x86_64 template generated by Packer on {{ isotime \"2006-01-02T15:04:05Z\" }}. Username: ansible",
      "vm_enable_qemu_agent": "true",
      "vm_memory": "2048",
      "vm_cores": "2",
      "vm_sockets": "2",
      "vm_cpu_type": "host",
      "vm_network_adapter_model": "virtio",
      "vm_network_adapter_bridge": "vmbr0",
      "vm_scsi_controller": "virtio-scsi-pci",
      "vm_disk_size": "50G",
      "vm_disk_type": "scsi",
      "vm_disk_format": "qcow2",
      "vm_storage_pool": "vm-store",
      "vm_storage_pool_type": "directory",
      "ssh_username": "ansible",
      "ssh_password": "ansible"
  },

  "sensitive-variables": ["proxmox_password"],

  "builders": [
      {
          "type": "proxmox",
          "proxmox_url": "{{user `proxmox_api_url`}}",
          "insecure_skip_tls_verify": true,
          "username": "{{user `proxmox_username`}}",
          "password": "{{user `proxmox_password`}}",
          "node": "{{user `proxmox_node`}}",
          "iso_file": "{{user `iso_filename`}}",
          "iso_checksum": "{{user `iso_checksum`}}",
          "qemu_agent": "{{user `vm_enable_qemu_agent`}}",
          "memory": "{{user `vm_memory`}}",
          "cores": "{{user `vm_cores`}}",
          "sockets": "{{user `vm_sockets`}}",
          "cpu_type": "{{user `vm_cpu_type`}}",
          "network_adapters": [
            {
              "bridge": "{{user `vm_network_adapter_bridge`}}",
              "model": "{{user `vm_network_adapter_model`}}"
            }
          ],
          "scsi_controller": "{{user `vm_scsi_controller`}}",
          "disks": [
            {
              "type": "{{user `vm_disk_type`}}",
              "disk_size": "{{user `vm_disk_size`}}",
              "format": "{{user `vm_disk_format`}}",
              "storage_pool": "{{user `vm_storage_pool`}}",
              "storage_pool_type": "{{user `vm_storage_pool_type`}}"
            }
          ],
    
          "http_directory": "rocky/8.5/config",
          "boot_wait": "3s",
          "boot_command": [
            "<tab> text inst.ks=http://{{ .HTTPIP }}:{{ .HTTPPort }}/ks.cfg<enter><wait>"
          ],
    
          "ssh_username": "{{user `ssh_username`}}",
          "ssh_password": "{{user `ssh_password`}}",
          "ssh_timeout": "20m",

          "unmount_iso": true,
          "template_name": "{{user `template_name`}}",
          "template_description": "{{user `template_description`}}",
          "cloud_init": true,
          "cloud_init_storage_pool": "{{user `vm_storage_pool`}}"
        }
  ],

  "provisioners": [
      {
        "type": "shell",
        "inline": ["echo 'Template build complete'"]
      }
  ]    

}